<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>JourneyMap</title>

    <meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="JourneyMap Team" name="author">

    <!-- IDEA says this isn't actually valid, we should do this server-side -->
    <!-- <meta http-equiv="Cache-Control" content="no-cache">-->

    <link href="favicon.ico" rel="shortcut icon">
    <link href="img/ico/journeymap.png" rel="apple-touch-icon-precomposed">
    <link href="bundled/main.css" rel="stylesheet">
</head>
<body>
<div id="main">
    <l-map :bounds="map_bounds"
           :fade-animation="false"
           :max-zoom="5"
           :min-zoom="-2"
           :zoom="0"

           crs="L.CRS.Simple"
           ref="map"

           @ready="mapReady" @update:center="centerUpdated" @zoom="updateZoom" id="map"
           @click="onMapClicked">
        <l-tile-layer :tile-layer-class="getTileClass" :tile-size="512" ref="tiles"
                      v-if="status === 'ready'"></l-tile-layer>

        <l-control :position="'topleft'"
                   class="leaflet-bar leaflet-control"
                   v-if="status === 'ready'">
            <a @click="toggleFollowMode()" id="center">
                <img :src="followIcon"/>
            </a>
        </l-control>

        <l-control :position="'topright'"
                   class="leaflet-control"
                   v-if="status === 'ready'">
            <a>
                <span id="coords" v-text="mouseCoords"></span>
            </a>
        </l-control>

        <l-control :position="'topleft'"
                   class="leaflet-bar leaflet-control"
                   v-if="status === 'ready'">
            <a @click="setMapMode('day')" id="mapTypeDay">
                <img :src="dayIcon"/>
            </a>
            <a @click="setMapMode('night')" id="mapTypeNight">
                <img :src="nightIcon"/>
            </a>
            <a @click="setMapMode('topo')" id="mapTypeTopo">
                <img :src="topoIcon"/>
            </a>
            <a @click="setMapMode('underground')" id="mapTypeUnderground">
                <img :src="undergroundIcon"/>
            </a>
            <!-- I honestly have no clue what the heck a "surface" map is, and I can't get it to render anything -->
            <!-- <a @click="setMapMode('surface')" id="mapTypeSurface">-->
            <!-- <img :src="followIcon"/>-->
            <!-- </a>-->
        </l-control>

        <l-marker :icon="getMarkerIconObj(marker)"
                  :key="marker.key"
                  :lat-lng="marker.latLng"
                  :options="marker.options"
                  :z-index-offset="marker.zIndex ? marker.zIndex : 0"

                  v-if="status === 'ready'"
                  v-for="(marker) in markers"
        ></l-marker>

        <l-polygon :color="waypoint.color"
                   :fill-color="waypoint.color"
                   :fill-opacity="0.7"
                   :lat-lngs="waypoint.latLngs"

                   v-if="status === 'ready'"
                   v-for="(waypoint) in waypoints"
        ></l-polygon>

        <l-polygon :color="polygon.strokeColor"
                   :fill-color="polygon.fillColor"
                   :fill-opacity="polygon.fillOpacity"
                   :lat-lngs="polygon.latLngs"
                   :opacity="polygon.strokeOpacity"
                   :weight="polygon.strokeWidth"

                   v-if="status === 'ready'"
                   v-for="(polygon) in polygons"
        ></l-polygon>
    </l-map>

    <b-modal :active="status !== 'ready'"
             :can-cancel="false"
             aria-modal
             aria-role="dialog"
             custom-class="front"
             trap-focus
    >
        <div class="card">
            <div class="card-content">
                <div class="content" v-if="status === 'no_world'">
                    No world is loaded - please join a server, or start a single-player world.
                </div>
                <div class="content" v-if="status === 'starting'">
                    JourneyMap is busy, please wait...
                </div>
            </div>
        </div>

    </b-modal>
</div>

<script src="bundled/bundle.js"></script>
</body>
</html>
